import{createPopover as e}from"./popover.js";const t='\n<slot name="trigger"></slot>\n<dialog tabindex="-1" part="popover" role="menu">\n\t<slot></slot>\n</dialog>\n',n="\n:host {\n\tdisplay: inline-block;\n}\n\ndialog {\n\tposition: fixed;\n\toutline: none;\n\tpadding: 0;\n\tmargin: 0;\n\tborder: var(--cek-border);\n\tbox-shadow:  var(--cek-shadow-3);\n\tborder-radius: var(--cek-border-radius);\n\tbackground-color: var(--cek-surface-color-0);\n}\n";class o extends HTMLElement{static get observedAttributes(){return["placement","trigger","modal","open","popover-width"]}#e;#t;#n;#o;#r;#i="";#s=null;constructor(){super(),this.shadowRoot||(this.attachShadow({mode:"open",delegatesFocus:!0}),this.shadowRoot.innerHTML=`<style>${n}</style>${t}`),this.#a(),this.#h()}get placement(){return this.getAttribute("placement")??"bottom-start"}get trigger(){return this.getAttribute("trigger")??"click"}get offset(){return+this.getAttribute("offset")??0}get menuItems(){return Array.from(this.querySelectorAll(":scope > cek-menu-item"))}get modal(){return this.hasAttribute("modal")&&"false"!==this.getAttribute("modal")}set modal(e){this.setAttribute("modal",e)}get open(){return this.hasAttribute("open")}get arrow(){return this.getAttribute("arrow")}get popoverWidth(){return this.getAttribute("popover-width")??"content-width"}get serverRendered(){return this.hasAttribute("server-rendered")}attributeChangedCallback(e,t,n){"modal"===e?["true",null].includes(n)?(this.#e=this.shadowRoot.querySelector("[part=popover]"),this.#e?.setAttribute("popover","manual")):this.#e?.hasAttribute("popover")&&this.#e?.removeAttribute("popover"):"open"===e&&[null,"false"].includes(t)&&"none"===window.getComputedStyle(this.#e).display&&this.show({focusOnMenuItem:!1,force:!0})}connectedCallback(){this.#l(),this.#u()}disconnectedCallback(){this.#c()}#u(){this.addEventListener("keydown",this.#m),this.#e.addEventListener("mouseout",this.#p),this.addEventListener("focusout",this.#d),this.addEventListener("click",this.#g),this.#e.addEventListener("mouseover",this.#v),this.addEventListener("focusin",this.#v),this.#e.addEventListener("pointermove",this.#b),this.addEventListener("cek-select",this.#f),this.#o?(this.#n.addEventListener("pointermove",this.#E),this.#n.addEventListener("click",this.#k)):(this.#t.addEventListener("keydown",this.#w),this.#t.addEventListener("click",this.#y),"hover"===this.trigger&&(this.#t.addEventListener("mouseover",this.#M),this.#t.addEventListener("mouseout",this.#A)))}#c(){this.removeEventListener("keydown",this.#m),this.#e.removeEventListener("mouseout",this.#p),this.removeEventListener("focusout",this.#d),this.removeEventListener("click",this.#g),this.#e.removeEventListener("mouseover",this.#v),this.#e.removeEventListener("mousemove",this.#b),this.removeEventListener("cek-select",this.#f),this.#o?(this.#n.removeEventListener("pointermove",this.#E),this.#n.removeEventListener("click",this.#k)):(this.#t.removeEventListener("keydown",this.#w),this.#t.removeEventListener("click",this.#y),"hover"===this.trigger&&(this.#t.removeEventListener("mouseover",this.#M),this.#t.removeEventListener("mouseout",this.#A)))}#b=e=>{e.preventDefault(),e.stopImmediatePropagation(),"touch"!==e.pointerType&&"cek-menu-item"===e.target.tagName.toLowerCase()&&document.activeElement!==e.target&&e.target.focus()};#f=()=>{this.open&&this.hide()};#p=e=>{e.preventDefault(),e.stopImmediatePropagation(),"hover"!==this.trigger||this.#e.contains(e.relatedTarget)||this.contains(e.relatedTarget)||!this.open||this.hide({focusOnTrigger:!1}),"cek-menu-item"===e.relatedTarget?.tagName.toLowerCase()||this.shadowRoot.contains(e.relatedTarget)||!this.contains(e.relatedTarget)&&e.target.parentElement?.hasAttribute("open")&&(e.target.hasAttribute("open")&&e.target.querySelector("[slot=submenu]")?.hide(),this.#e.focus())};#v=e=>{if(e.preventDefault(),e.stopImmediatePropagation(),!e.target||"cek-menu-item"!==e.target.tagName.toLowerCase())return;const t=e.target.parentElement.menuItems.find((e=>e.querySelector("[slot=submenu]"))),n=t?.querySelector("[slot=submenu]")?.hasAttribute("open");"cek-menu-item"===e.target.tagName.toLowerCase()&&e.target.parentElement.menuItems.includes(e.target)&&e.target!==t&&n&&(t?.querySelector("[slot=submenu]")?.hide(),e.target.focus())};#k=e=>{e.preventDefault(),e.stopImmediatePropagation(),this.open?this.hide({focusOnTrigger:!1}):this.show({focusOnMenuItem:!0})};#E=e=>{e.preventDefault(),e.stopImmediatePropagation(),"touch"!==e.pointerType&&(this.open?"true"===e.target.getAttribute("open")&&this?.focus():this.show({focusOnMenuItem:!1}))};#M=()=>{this.open||this.show({focusOnMenuItem:!0})};#A=e=>{!this.contains(e.relatedTarget)&&this.open&&this.hide({focusOnTrigger:!1})};#y=e=>{e.preventDefault(),e.stopImmediatePropagation(),e.target.hasAttribute("open")?this.hide():this.show({focusOnMenuItem:!0})};#w=e=>{"ArrowDown"===e.key&&(e.preventDefault(),e.stopImmediatePropagation(),this.show({focusOnMenuItem:!0})),"ArrowUp"===e.key&&(e.preventDefault(),e.stopImmediatePropagation(),this.show({focusOnMenuItem:!0,onOpenMenuItemIndexToFocus:this.menuItems.length-1}))};#g=e=>{if(e.preventDefault(),e.stopImmediatePropagation(),"cek-menu-item"===e.target.tagName.toLowerCase()&&e.target.value&&(this.hide(),this.dispatchEvent(new CustomEvent("cek-select",{detail:{value:e.target.value},bubbles:!0})),["radio","checkbox"].includes(e.target.getAttribute("type"))))for(const t of this.menuItems)t!==e.target?t.removeAttribute("checked"):t.setAttribute("checked","")};#d=e=>{e.preventDefault(),e.stopImmediatePropagation(),"cek-button"===e.target?.tagName.toLowerCase()&&"cek-menu-item"!==e.relatedTarget?.tagName.toLowerCase()&&this.hide(),this.contains(e.relatedTarget)};#m=e=>{const t=this.menuItems,n=t.indexOf(e.target),o=t.at(n)?.querySelector("[slot=submenu]"),r=()=>{e.preventDefault(),e.stopImmediatePropagation()},i=e=>{const n=t.at(e);n?.focus()};switch(e.key){case"Escape":this.hide(),r();break;case"ArrowRight":if(r(),o?.getAttribute("placement").startsWith("right")){e.target.hasAttribute("open")?o.menuItems.at(0).focus():o.show({focusOnMenuItem:!0});break}this.getAttribute("placement")?.startsWith("left")&&this.hide();break;case"ArrowLeft":if(r(),o?.getAttribute("placement").startsWith("left")){o.show({focusOnMenuItem:!0});break}this.getAttribute("placement")?.startsWith("right")&&this.hide();break;case"ArrowDown":r(),i(n===t.length-1?0:n+1);break;case"ArrowUp":r(),i(0===n?-1:n-1);break;case"PageDown":r(),i(-1);break;case"PageUp":r(),i(0);break;default:this.#I(e)}};show({focusOnMenuItem:e=!0,onOpenMenuItemIndexToFocus:t=0,force:n=!1}){if(!this.open||n)this.modal?this.#e.showPopover():this.#e.show(),this.#r.startAutoUpdatePosition(),e&&this.menuItems.at(t).focus(),this.#n.setAttribute("aria-expanded","true"),this.#t.setAttribute("open",""),this.setAttribute("open","");else if(this.open){if(this.menuItems.find((e=>e===document.activeElement)))return;this.menuItems.at(t).focus()}}hide({focusOnTrigger:e}={focusOnTrigger:!0}){if(this.open){this.modal?(this.#e.hidePopover(),document.body.style.overflow=""):this.#e.close(),this.#r.stopAutoUpdatePosition(),this.#n.setAttribute("aria-expanded","false"),this.#t.removeAttribute("open"),this.removeAttribute("open"),e&&this.#n.focus();for(const e of this.querySelectorAll("[slot=submenu]"))e.hide({focusOnTrigger:!1})}}#l(){const e=this.#e.closest("dialog");let t=0;if(e){const n=window.getComputedStyle(e).zIndex;t=Number.parseInt(n,10)||0}this.#e.style.zIndex=t+1}#I(e){const t=e.key.toLowerCase();if(1===t.length&&/\S/.test(t)){this.#i+=t;const e=this.#L().menuItems.find((e=>e.textContent.trim().toLowerCase().startsWith(this.#i)));e&&(e.focus(),e.scrollIntoView({behavior:"smooth",block:"nearest"})),clearTimeout(this.#s),this.searchTimeout=setTimeout((()=>{this.#i=""}),500)}}#L(){let e=document.activeElement;for(;e&&"cek-menu"!==e.tagName.toLowerCase();)e=e.parentElement;return e||this}#a(){this.#e=this.shadowRoot.querySelector("[part=popover]"),this.#o="submenu"===this.getAttribute("slot"),this.#t=this.#o?this.parentElement:this.querySelector("[slot=trigger]"),this.#n=this.#t.shadowRoot.querySelector("button"),this.#n.setAttribute("aria-haspopup","true"),this.#n.setAttribute("aria-expanded","false")}#h(){this.#r=e({anchorElement:this.#t,popoverElement:this.#e,placement:this.placement,offset:this.offset,popoverWidth:this.popoverWidth})}}const r='\n<button part="button" tabindex="-1" role="menuitem">\n    <span part="checked">\n\t\t<svg aria-hidden="true" part="check-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">\n\t\t\t<path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />\n  \t\t</svg>\n\t\t<svg aria-hidden="true" part="circle-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">\n        \t<circle cx="50" cy="50" r="50" fill="currentColor" />\n    \t</svg>\n  \t</span>\n\t<slot name="start"></slot>\n\t<slot></slot>\n\t<slot name="end"></slot>\n</button>\n<slot name="submenu"></slot>\n',i='\n:host {\n\tdisplay: flex;\n}\n\n:host([open]) :where(a, button) {\n\tbackground-color: var(--cek-surface-color-0);\n}\n\nsvg[part=arrow-icon] {\n\twidth: 1em;\n\theight: 1em;\n\tmargin-inline: var(--cek-space-2);\n}\n\nbutton, a {\n\tposition: relative;\n\tappearance: none;\n\tborder: 0;\n\tborder-radius: var(--cek-border-radius);\n\tbackground-color: var(--cek-surface-color-0);\t\n\tpadding: var(--cek-space-2) var(--cek-space-3);;\n\tmargin: var(--cek-space-2);\n\tfont: inherit;\n\tcolor: var(--cek-text-color-2);\n\ttext-align: inherit;\n\tflex: auto;\n\tfont-family: var(--cek-font-family);\n\tline-height: var(--cek-line-height);\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tcursor: pointer;\n\tbox-sizing: border-box;\n\ttext-decoration: none;\n\tmin-height: var(--cek-height-small);\n\n\t&:focus {\n\t    background-color: var(--cek-surface-color-1);\n\t\toutline: none;\n\t}\n}\n\n:host [part=checked] svg {\n\tdisplay: none;\n}\n\n:host(:is([type=checkbox], [type=radio])) [part=checked] {\n\twidth: var(--cek-space-7);\n}\n\n:host([type="checkbox"][checked=""]) [part=check-icon] {\n\tdisplay: flex;\n\twidth: 0.9em;\n\theight: 0.9em;\n}\n\n:host([type="radio"][checked=""]) [part=circle-icon] {\n\tdisplay: flex;\n\twidth: 0.5em;\n\theight: 0.5em;\n}\n\nslot[name=start], slot[name=end] {\n    flex: 0 0 auto;\n}\n\nslot {\n    flex: 1 1 auto;\n    display: inline-block;\n\tmargin-inline: var(--cek-space-2);\n}\n\nslot[name=submenu] {\n    display: contents;\n}\n\n::slotted(cek-icon) {\n\tmargin-inline: var(--cek-space-1);\n}\n\n::slotted(cek-icon) {\n\tfont-size: 1.3em;\n}\n';customElements.define("cek-menu",o);export{o as Menu,r as menuItemHtml,i as menuItemStyles,n as menuStyles,t as menuTemplate};
